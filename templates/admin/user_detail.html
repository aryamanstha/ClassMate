{% extends "admin/base.html" %}
{% block admin_content %}

<div class="admin-header">
  <div>
    <h1><i class="bi bi-shield-lock"></i> User Account: {{ user.username }}</h1>
    <p class="text-muted mb-0">Manage user credentials and access permissions</p>
  </div>
  <div>
    {% if user.is_active %}
      <span class="badge bg-success">Active</span>
    {% else %}
      <span class="badge bg-danger">Inactive</span>
    {% endif %}
  </div>
</div>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs" role="tablist" style="margin-bottom: 2rem;">
  <li class="nav-item">
    <a class="nav-link active" id="account-tab" data-bs-toggle="tab" href="#account" role="tab">Account Details</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="security-tab" data-bs-toggle="tab" href="#security" role="tab">Security</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="access-tab" data-bs-toggle="tab" href="#access" role="tab">Access Control</a>
  </li>
</ul>

<div class="tab-content">
  <!-- Account Details Tab -->
  <div class="tab-pane fade show active" id="account" role="tabpanel">
    <div class="detail-section">
      <h3 class="section-title"><i class="bi bi-person-vcard"></i> Account Information</h3>
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="action" value="update">
        
        <div class="row">
          <div class="form-group col-md-6">
            <label for="username">Username *</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
          </div>
          <div class="form-group col-md-6">
            <label for="email">Email *</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
          </div>
        </div>

        <div class="row">
          <div class="form-group col-md-6">
            <label for="first_name">First Name</label>
            <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}">
          </div>
          <div class="form-group col-md-6">
            <label for="last_name">Last Name</label>
            <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.last_name }}">
          </div>
        </div>

        <div class="row">
          <div class="form-group col-md-6">
            <label>Account Type:</label>
            <div class="mt-2">
              {% if user.studentaccount %}
                <span class="badge bg-success">Student</span>
              {% elif user.instructoraccount %}
                <span class="badge bg-info">Instructor</span>
              {% else %}
                <span class="badge bg-secondary">None</span>
              {% endif %}
            </div>
          </div>
          <div class="form-group col-md-6">
            <label>Account Created:</label>
            <div class="mt-2">
              <p class="text-muted">{{ user.date_joined|date:"M d, Y H:i" }}</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <a href="{% url 'admin_user_accounts' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Security Tab -->
  <div class="tab-pane fade" id="security" role="tabpanel">
    <div class="detail-section">
      <h3 class="section-title"><i class="bi bi-shield-check"></i> Password Management</h3>
      <p class="text-muted mb-3">Reset the user's password to a temporary one.</p>
      
      <a href="{% url 'admin_reset_user_password' user.id %}" class="btn btn-warning mb-3">
        <i class="bi bi-key"></i> Reset Password
      </a>
    </div>

    <div class="detail-section">
      <h3 class="section-title"><i class="bi bi-toggle2-on"></i> Account Status</h3>
      
      {% if user.is_active %}
        <p class="text-muted mb-3">This account is currently <strong>active</strong>. Click below to disable it.</p>
        <form method="POST" action="{% url 'admin_disable_user' user.id %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-ban"></i> Disable Account
          </button>
        </form>
      {% else %}
        <p class="text-muted mb-3">This account is currently <strong>inactive</strong>. Click below to enable it.</p>
        <form method="POST" action="{% url 'admin_enable_user' user.id %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-success">
            <i class="bi bi-check-circle"></i> Enable Account
          </button>
        </form>
      {% endif %}
    </div>
  </div>

  <!-- Access Control Tab -->
  <div class="tab-pane fade" id="access" role="tabpanel">
    <div class="detail-section">
      <h3 class="section-title"><i class="bi bi-key"></i> Admin Access</h3>
      
      {% if user.is_staff %}
        <p class="text-muted mb-3">This user has <strong>admin privileges</strong>. Click below to revoke them.</p>
        <a href="{% url 'admin_revoke_admin_access' user.id %}" class="btn btn-danger">
          <i class="bi bi-lock"></i> Revoke Admin Access
        </a>
      {% else %}
        <p class="text-muted mb-3">This user does <strong>not</strong> have admin privileges. Click below to grant them.</p>
        <a href="{% url 'admin_grant_admin_access' user.id %}" class="btn btn-success">
          <i class="bi bi-unlock"></i> Grant Admin Access
        </a>
      {% endif %}
    </div>

    <div class="detail-section">
      <h3 class="section-title"><i class="bi bi-info-circle"></i> Permission Summary</h3>
      <table class="table table-borderless">
        <tr>
          <td><strong>Is Staff:</strong></td>
          <td>
            {% if user.is_staff %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td><strong>Is Superuser:</strong></td>
          <td>
            {% if user.is_superuser %}
              <span class="badge bg-danger">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td><strong>Is Active:</strong></td>
          <td>
            {% if user.is_active %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-danger">No</span>
            {% endif %}
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

{% endblock %}
